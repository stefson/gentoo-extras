# HG changeset patch
# User Emilio Cobos √Ålvarez <emilio@crisal.io>
# Date 1648393420 -7200
# Node ID 5664e4a15c4b85da07f15a21c61217e6b2efaa77
# Parent  44c199e3b2fc75a62729e2e0623141560b6c964c
Bug 1761663 - Fix --disable-dbus build.

MANUAL PUSH: Trivial non-default build configuration fix.


diff --git a/widget/gtk/GRefPtr.h b/widget/gtk/GRefPtr.h
--- a/widget/gtk/GRefPtr.h
+++ b/widget/gtk/GRefPtr.h
@@ -7,18 +7,20 @@
 #define GRefPtr_h_
 
 // Allows to use RefPtr<T> with various kinds of GObjects
 
 #include <gdk/gdk.h>
 #include <gtk/gtk.h>
 #include "mozilla/RefPtr.h"
 
+#ifdef MOZ_ENABLE_DBUS
 // TODO: Remove this (we should use GDBus instead, which is not deprecated).
-#include <dbus/dbus-glib.h>
+#  include <dbus/dbus-glib.h>
+#endif
 
 namespace mozilla {
 
 template <typename T>
 struct GObjectRefPtrTraits {
   static void AddRef(T* aObject) { g_object_ref(aObject); }
   static void Release(T* aObject) { g_object_unref(aObject); }
 };
@@ -33,17 +35,19 @@ GOBJECT_TRAITS(GMenu)
 GOBJECT_TRAITS(GMenuItem)
 GOBJECT_TRAITS(GSimpleAction)
 GOBJECT_TRAITS(GSimpleActionGroup)
 GOBJECT_TRAITS(GDBusProxy)
 GOBJECT_TRAITS(GAppInfo)
 GOBJECT_TRAITS(GdkDragContext)
 GOBJECT_TRAITS(GdkPixbuf)
 
+#ifdef MOZ_ENABLE_DBUS
 GOBJECT_TRAITS(DBusGProxy)
+#endif
 
 #undef GOBJECT_TRAITS
 
 template <>
 struct RefPtrTraits<GVariant> {
   static void AddRef(GVariant* aVariant) { g_variant_ref(aVariant); }
   static void Release(GVariant* aVariant) { g_variant_unref(aVariant); }
 };
@@ -57,21 +61,23 @@ struct RefPtrTraits<GHashTable> {
 template <>
 struct RefPtrTraits<GDBusNodeInfo> {
   static void AddRef(GDBusNodeInfo* aObject) { g_dbus_node_info_ref(aObject); }
   static void Release(GDBusNodeInfo* aObject) {
     g_dbus_node_info_unref(aObject);
   }
 };
 
+#ifdef MOZ_ENABLE_DBUS
 template <>
 struct RefPtrTraits<DBusGConnection> {
   static void AddRef(DBusGConnection* aObject) {
     dbus_g_connection_ref(aObject);
   }
   static void Release(DBusGConnection* aObject) {
     dbus_g_connection_unref(aObject);
   }
 };
+#endif
 
 }  // namespace mozilla
 
 #endif


