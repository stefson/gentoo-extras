From: Jory Pratt <anarchy@gentoo.org>
Date: Tue, 19 Mar 2019 10:58:57 -0500
Subject: Fix toolkit for musl support

---
 .../google-breakpad/src/common/linux/dump_symbols.cc          | 1 +
 .../crashreporter/google-breakpad/src/common/stabs_reader.cc  | 4 ++++
 .../crashreporter/google-breakpad/src/common/stabs_reader.h   | 2 +-
 toolkit/mozapps/update/common/updatedefines.h                 | 2 +-
 toolkit/mozapps/update/updater/updater.cpp                    | 2 ++
 5 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/toolkit/crashreporter/google-breakpad/src/common/linux/dump_symbols.cc b/toolkit/crashreporter/google-breakpad/src/common/linux/dump_symbols.cc
index 0ccc9f54ed..9d2f345906 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/linux/dump_symbols.cc
+++ b/toolkit/crashreporter/google-breakpad/src/common/linux/dump_symbols.cc
@@ -46,6 +46,7 @@
 #include <sys/mman.h>
 #include <sys/stat.h>
 #include <unistd.h>
+#include <libgen.h>
 
 #include <iostream>
 #include <set>
diff --git a/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.cc b/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.cc
index 6019fc7ee2..5953e32d0b 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.cc
+++ b/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.cc
@@ -41,6 +41,10 @@
 
 #include "common/using_std_string.h"
 
+#ifndef N_UNDF
+#define N_UNDF 0
+#endif
+
 using std::vector;
 
 namespace google_breakpad {
diff --git a/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.h b/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.h
index 98ee2dd53b..d57aa6807f 100644
--- a/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.h
+++ b/toolkit/crashreporter/google-breakpad/src/common/stabs_reader.h
@@ -55,7 +55,7 @@
 
 #ifdef HAVE_MACH_O_NLIST_H
 #include <mach-o/nlist.h>
-#elif defined(HAVE_A_OUT_H)
+#elif 0
 #include <a.out.h>
 #endif
 
diff --git a/toolkit/mozapps/update/common/updatedefines.h b/toolkit/mozapps/update/common/updatedefines.h
index 79276f7cb7..8ed2234975 100644
--- a/toolkit/mozapps/update/common/updatedefines.h
+++ b/toolkit/mozapps/update/common/updatedefines.h
@@ -102,7 +102,7 @@ static inline int mywcsprintf(WCHAR* dest, size_t count, const WCHAR* fmt,
 
 #  ifdef SOLARIS
 #    include <sys/stat.h>
-#  else
+#elif !defined(__linux__) || defined(__GLIBC__)
 #    include <fts.h>
 #  endif
 #  include <dirent.h>
diff --git a/toolkit/mozapps/update/updater/updater.cpp b/toolkit/mozapps/update/updater/updater.cpp
index 96acd1eb66..24d0389ac1 100644
--- a/toolkit/mozapps/update/updater/updater.cpp
+++ b/toolkit/mozapps/update/updater/updater.cpp
@@ -3923,6 +3923,7 @@ int add_dir_entries(const NS_tchar *dirpath, ActionList *list) {
 
 int add_dir_entries(const NS_tchar *dirpath, ActionList *list) {
   int rv = OK;
+#if !defined(__linux__) || defined(__GLIBC__)
   FTS *ftsdir;
   FTSENT *ftsdirEntry;
   mozilla::UniquePtr<NS_tchar[]> searchpath(get_full_path(dirpath));
@@ -4030,6 +4031,7 @@ int add_dir_entries(const NS_tchar *dirpath, ActionList *list) {
   }
 
   fts_close(ftsdir);
+#endif
 
   return rv;
 }
-- 
2.21.0
